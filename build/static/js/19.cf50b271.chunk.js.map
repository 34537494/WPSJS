{"version":3,"sources":["sources/RepositoryUtils.js","components/WebAddinWriter/WriteComponents/fillTable/fillTable.js","components/WebAddinWriter/WriteComponents/pages/fillTable/index.js"],"names":["GetRealData","response","GetRealDataOfYear","GetRealDataOfFinance","JsonToTree","JsonStr","SearchKey","tmpJson","indexOf","JsonObj","JSON","parse","p","title","substring","lastIndexOf","key","subJson","s","lastJson","subjsonstr","stringify","push","length","children","ConvertJsonToTree","jsonArray","TreeJson","a","child","console","log","ConvertJsonToTreeOfYear","ConvertJsonToTreeOfFinance","numOfFinance","TreeAndNumber","lastNum","value","checkedIDs","onSelect","selectedKeys","info","mather","baction","FillTable","props","onCheck","state","selectData","checkedKeys","undefined","tsId","wps","PluginStorage","getItem","tskpane","GetTaskPane","Visible","Width","util","GetUrlPath","CreateTaskPane","id","ID","setItem","reloaddata","Company","handlePost","apiWritePath","then","result","success","realdata","treeData","setState","error","insertdata","data","公司ID","文本元编号","CurWord","WpsApplication","Buffer","from","msg","toString","ActiveDocument","Range","Selection","Start","End","InsertXML","this","onClick","bind","checkable","multiple","React","Component","Fill"],"mappings":"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","file":"static/js/19.cf50b271.chunk.js","sourcesContent":["import Tree from \"rc-tree\";\n\nexport function GetRealData(response) {\n  //获得实际数据\n  if (response[\"success\"]) {\n    if (response[\"head\"] == null) {\n      if (response[\"msg\"] == null) {\n        return \"\";\n      } else {\n        return response[\"msg\"];\n      }\n    } else {\n      return '{\"head\":' + response[\"head\"] + ',\"data\":' + response[\"msg\"] + \"}\";\n    }\n  } else {\n    return \"\";\n  }\n}\n\nexport function GetRealDataOfYear(response) {\n  //获得实际数据\n  if (response[\"success\"]) {\n    if (response[\"head\"] != null) {\n      if (response[\"msg\"] == null) {\n        return \"\";\n      } else {\n        return response[\"msg\"];\n      }\n    } else {\n      return '{\"head\":' + response[\"head\"] + ',\"data\":' + response[\"msg\"] + \"}\";\n    }\n  } else {\n    return \"\";\n  }\n}\n\nexport function GetRealDataOfFinance(response) {\n  //获得实际数据\n  if (response[\"success\"]) {\n    if (response[\"head\"] == null) {\n      if (response[\"msg\"] == null) {\n        return \"\";\n      } else {\n        return response[\"msg\"];\n      }\n    } else {\n      return '{\"head\":' + response[\"head\"] + ',\"data\":' + response[\"msg\"] + \"}\";\n    }\n  } else {\n    return \"\";\n  }\n}\n\nfunction JsonToTree(JsonStr, SearchKey) {\n  //将json转换为antidesign tree控件的数据源\n  //思路：遍历重建\n  //https://blog.csdn.net/xujie3/article/details/52954940\n  var tmpJson = {};\n  if (JsonStr.indexOf(SearchKey) !== -1) {\n    var JsonObj = JSON.parse(JsonStr);\n    for (var p in JsonObj) {\n      //遍历json数组\n      let title = p.substring(p.indexOf(\"_\") + 1);\n      tmpJson.title = title.substring(0, title.lastIndexOf(\":\"));\n      tmpJson.key = title.substring(title.lastIndexOf(\":\") + 1);\n      let subJson = [];\n      for (var s in JsonObj[p]) {\n        let lastJson = {};\n        if (JsonObj[p][s] !== \"\") {\n          let subjsonstr = '{\"' + s + '\":' + JSON.stringify(JsonObj[p][s]) + \"}\";\n          lastJson = JsonToTree(subjsonstr, SearchKey);\n          if (subjsonstr.indexOf(SearchKey) !== -1) {\n            subJson.push(lastJson);\n          }\n        } else {\n          //console.log(\"s:\", s);\n          if (s.indexOf(SearchKey) !== -1) {\n            let title = s.substring(s.indexOf(\"_\") + 1);\n            lastJson.title = title.substring(0, title.lastIndexOf(\":\"));\n            lastJson.key = title.substring(title.lastIndexOf(\":\") + 1);\n            subJson.push(lastJson);\n          }\n        }\n      }\n      if (subJson.length > 0) {\n        tmpJson.children = subJson;\n      }\n    }\n  }\nreturn tmpJson;\n}\n\nexport function ConvertJsonToTree(jsonArray, SearchKey) {\n  //将json转换为antidesign tree控件的数据源，要用到递归\n  var TreeJson = [];\n  for (var a in jsonArray) {\n    //遍历json数组时，这么写p为索引，0,1\n    //console.log(a);\n    //console.log(\"JsonStr:\", jsonArray[a][\"文本元结构\"]);\n    let child = JsonToTree(jsonArray[a][\"文本元结构\"], SearchKey);\n    //console.log(\"child:\", JSON.stringify(child) === \"{}\");\n    if (JSON.stringify(child) !== \"{}\") {\n      TreeJson.push(child);\n    }\n  }\n  console.log(\"TreeJson:\", TreeJson);\n  return TreeJson;\n}\n\nexport function ConvertJsonToTreeOfYear(jsonArray) {\n  //将json转换为antidesign tree控件的数据源，要用到递归\n  var TreeJson = [];\n  for (var a in jsonArray) {\n    //遍历json数组时，这么写p为索引，0,1\n    console.log(a);\n    console.log(\"JsonStr:\", jsonArray[a]);\n    let lastJson = {};\n    lastJson.title = jsonArray[a][\"年份\"];\n    lastJson.key = a;\n    TreeJson.push(lastJson);\n  }\n  console.log(\"TreeJson:\", TreeJson);\n  return TreeJson;\n}\n\nexport function ConvertJsonToTreeOfFinance(jsonArray) {\n  //将json转换为antidesign tree控件的数据源，要用到递归\n  var TreeJson = [];\n  var numOfFinance = [];\n  var TreeAndNumber = [];\n\n  var p = 0;\n  for (var a in jsonArray) {\n    if (a == \"财报ID\" || a == \"公司ID\") {\n      ///console.log(\"hhhhh\");\n    } else {\n      //console.log(jsonArray[\"\" + a]);\n      //console.log(\"JsonStr:\", a);\n      let lastJson = {};\n      let lastNum = {};\n      lastJson.title = a;\n      lastJson.key = p;\n      lastNum.key = p;\n      lastNum.value = jsonArray[\"\" + a];\n      TreeJson.push(lastJson);\n      numOfFinance.push(lastNum);\n      p++;\n    }\n  }\n  TreeAndNumber.push(TreeJson);\n  TreeAndNumber.push(numOfFinance);\n  //console.log(\"numOfFinance\", numOfFinance);\n  //console.log(\"TreeJson:\", TreeJson);\n  console.log(TreeAndNumber);\n  return TreeAndNumber;\n}\n","import React, { Component } from 'react';\r\nimport { Tree, Table, Button } from 'antd';\r\nimport { FormOutlined } from '@ant-design/icons';\r\n// import Btn from '../buttons';\r\nimport 'antd/dist/antd.css';\r\n// import { DownloadOutlined } from '@ant-design/icons';\r\nimport ctrolClick from './tableEvent';\r\n// import financeDetail from './detailTaskpane'\r\nimport util from \"../../../../js/util\"\r\nimport { handlePost } from \"../../../WebAddinCommon\";\r\nimport { GetRealDataOfYear, ConvertJsonToTreeOfYear } from \"../../../../../src/sources/RepositoryUtils\";\r\nimport { apiWritePath } from \"../../../../../src/settings\";\r\nimport { Consumer } from \"../../../../components/WebAddinContext\";\r\n/* global wps:false */\r\n\r\n\r\nvar checkedIDs = [];\r\nconst onSelect = (selectedKeys, info,mather,baction) => {\r\n    console.log(\"selectedKeys, info\", selectedKeys, info);\r\n    console.log(\"mather\", mather);\r\n    console.log(\"baction\",  baction);\r\n\r\n};\r\n\r\n\r\nclass FillTable extends React.Component {\r\n \r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            treeData: this.reloaddata(),\r\n        };\r\n    }\r\n    componentDidUpdate() {\r\n        console.log(\"FillTable_componentDidUpdate_this.props.location:\", this.props);\r\n         \r\n      }\r\n    UNSAFE_componentWillMount() {\r\n        console.log(\"FillTable_this.props.location:\", this.props);\r\n        // if (this.props.location.state !== undefined) {\r\n        //   this.setState({\r\n        //     curUser: this.props.location.state.curUser\r\n        //   });\r\n        //   //console.log(\"tplDetail_UNSAFE_componentWillMount:\",this.state.ShowDemo);\r\n        // } else {\r\n        //   //直接导航到compose\r\n        //   this.props.history.push(\"/\");\r\n        // }\r\n      }\r\n      onCheck = (state, selectData, checkedKeys) => {\r\n        console.log(\"onCheck\", checkedKeys);\r\n       //console.log(\"info\", info);\r\n     \r\n       //console.log(\"test bstate:\",tplData);\r\n       console.log(\"test selectData:\", selectData);\r\n       \r\n       if (selectData!== undefined){\r\n            selectData(checkedKeys);\r\n       }\r\n       console.log(\"test newstate:\",state);\r\n       checkedIDs = checkedKeys;\r\n       //return;\r\n\r\n       let tsId = wps.PluginStorage.getItem(\"filltable_1\")\r\n       if (!tsId) {\r\n           console.log(\"新taskpane：\", util.GetUrlPath().substring(0,util.GetUrlPath().lastIndexOf(\"/\"))+ \"writer/fillFinanceTable\")\r\n           let tskpane = wps.CreateTaskPane(util.GetUrlPath().substring(0,util.GetUrlPath().lastIndexOf(\"/\")) + \"writer/fillFinanceTable\")\r\n           let id = tskpane.ID\r\n           wps.PluginStorage.setItem(\"filltable_1\", id)\r\n           tskpane.Visible = true\r\n           tskpane.Width = 500\r\n       } else {\r\n           let tskpane = wps.GetTaskPane(tsId)\r\n           console.log(\"重新显示填表taskpane：\")\r\n           console.log(tskpane)\r\n           tskpane.Visible = true\r\n           tskpane.Width = 500\r\n       }\r\n   };\r\n    reloaddata = (state, selectData) => {\r\n        console.log(\"filltable state:\",state);\r\n        console.log(\"filltable this.state:\",this.state);\r\n        const Company = {};\r\n        Company.公司ID = 1;\r\n        handlePost(`${apiWritePath}getinf/getAll/getAllFinances`, Company).then((result) => {\r\n            // this.props.history.push(\"/\");\r\n            console.log(\"get-Repository-tree-result:\", result);\r\n            if (result.success === true) {\r\n                //加载数据到tree中\r\n                console.log(result)\r\n                let realdata = GetRealDataOfYear(result)\r\n                console.log(\"realdata\", realdata)\r\n                var treeData = ConvertJsonToTreeOfYear(realdata);\r\n                this.setState({\r\n                    treeData: treeData,\r\n                });\r\n            } else {\r\n\r\n            }\r\n            //console.log(\"logout_ok:\",this.state)\r\n        },\r\n            error => { });\r\n    }\r\n    insertdata = (state, selectData) => {\r\n        console.log(\"filltable state:\",state);\r\n        for (var id in checkedIDs) {\r\n            console.log(\"id:\", id);\r\n            var data = {};\r\n            data.公司ID = 1;\r\n            data.文本元编号 = id;\r\n            const CurWord = wps.WpsApplication();\r\n            handlePost(`${apiWritePath}download/downloadTextRepositoryXml`, data).then((result) => {\r\n                // this.props.history.push(\"/\");\r\n                console.log(\"get-Repository-tree-result:\", result);\r\n                if (result.success === true) {\r\n                    //插入数据到wps中\r\n                    console.log(\"result.msg:\", Buffer.from(result.msg, \"base64\").toString(\"utf-8\"))\r\n                    CurWord.ActiveDocument.Range(CurWord.Selection.Start, CurWord.Selection.End).InsertXML(Buffer.from(result.msg, \"base64\").toString(\"utf-8\"));\r\n                } else {\r\n                    //提示财务\r\n                }\r\n                //console.log(\"logout_ok:\",this.state)\r\n            },\r\n                error => { });\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n        <Consumer>\r\n        {({ state, selectData }) => (\r\n            <div>\r\n                <h2>报表自动填写 </h2>\r\n                {/* <Table rowSelection={rowSelection} columns={columns} dataSource={this.state.contentCtrolsVal} pagination={{ pageSize: 50, position: ['bottomLeft'] }} scroll={{ y: 450 }} />\r\n                <Button type=\"primary\" onClick = {this.financeDetail.bind()} icon={<FormOutlined />} size={\"large\"}>\r\n          设置\r\n        </Button> */}\r\n        \r\n                <Button onClick={this.insertdata.bind(this, state, selectData)}>插入</Button>\r\n                <Button onClick={this.reloaddata.bind(this, state, selectData)}>刷新</Button>\r\n                <br />\r\n                <Tree\r\n                    checkable\r\n                    onSelect={onSelect}\r\n                    onCheck={this.onCheck.bind(this, state, selectData)}\r\n                    treeData={this.state.treeData}\r\n                    multiple = {\"false\"}\r\n                />\r\n            </div>\r\n            )}\r\n            </Consumer>\r\n        )\r\n    }\r\n}\r\n\r\nexport default FillTable;\r\n","import React, { Component } from 'react';\r\n \r\nimport FillTable from '../../fillTable/fillTable';\r\n \r\n\r\nclass Fill extends Component {\r\n    render() {\r\n        return (\r\n            <div>\r\n                <FillTable />\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Fill;"],"sourceRoot":""}